##テーブル構造のみ取得
pg_dump -U postgres -d postgres -h 192.168.0.135 -t records -s > records.sql

##データベースバックアップ
pg_dump -h 192.168.0.135 -U postgres postgres > postgres.sql

##テーブル指定してバックアップ
pg_dump -h 192.168.0.135 -U postgres --format plain  --table public.records postgres > table.sql

##crontab -e バックアップ
 export PGPASSWORD='postgres'; pg_dump -h 192.168.0.135 -U postgres --format plain  --table public.records postgres > /opt/db_backup/tables/records.sql
 export PGPASSWORD='postgres'; pg_dump -h 192.168.0.135 -U postgres > /opt/db_backup/dbs/postgres.sql


##records 月間書き込み実績 function

CREATE OR REPLACE FUNCTION daily() 
RETURNS TABLE (
        Insertdate timestamp with time zone,
        Total bigint
) AS $$
DECLARE 
    var_r record;
BEGIN
    RETURN QUERY 
    SELECT 
	date_trunc('day', records.created_at) as Insertdate,
    sum (quantity) as Total
	from records
	 group by Insertdate
  	ORDER BY Insertdate DESC;
END; $$ 
LANGUAGE 'plpgsql';

##records 月間書き込み実績 表示用SQL

SELECT date_trunc('day', created_at) as Insertdate,
sum (quantity) as totalquantities
from records
group by Insertdate
ORDER BY Insertdate;